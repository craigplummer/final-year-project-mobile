<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Ticketseller Mobile</title>
	<link rel="stylesheet" href="jquery-mobile/jquery.mobile-1.0a3.min.css" />
	<script src="http://code.jquery.com/jquery-1.5.min.js"></script>
	<script src="lawnchair/Lawnchair.js"></script>
	<script src="lawnchair/DOMStorageAdaptor.js"></script>
	<script src="lawnchair/LawnchairAdaptorHelpers.js"></script>
	<script src="xui/xui-2.0.0.min.js"></script>
	<script src="phonegap.js"></script>
	<script src="navigationBar.js"></script>
	<script src="NativeControls.js"></script>
	<script src="jquery-mobile/jquery.mobile-1.0a3.min.js"></script>
	
	<script type="text/javascript">
	
	// Call onDeviceReady when PhoneGap is loaded.
    //
    // At this point, the document has loaded but phonegap.js has not.
    // When PhoneGap is loaded and talking with the native device,
    // it will call the event `deviceready`.
    // 
    function onLoad() {
        document.addEventListener("deviceready", onDeviceReady, false);
    }

    // PhoneGap is loaded and it is now safe to make calls PhoneGap methods
    //
    function onDeviceReady() {
	var uicontrols = window.plugins.uicontrols; 
        uicontrols.createNavigationBar(); 
		uicontrols.setNavigationBarTitle("Ticketseller");
		
		 window.plugins.nativeControls.createTabBar(); 
		window.plugins.nativeControls.createTabBarItem("id_tab1","tab1","tabButton: TopRated"); 
		window.plugins.nativeControls.createTabBarItem("id_tab2","tab2","tabButton: Contacts", 
{ 
onSelect: function() { alert ("test"); } 
}); 

window.plugins.nativeControls.createTabBarItem("id_tab3","tab3","tabButton: Bookmarks"); 
window.plugins.nativeControls.createTabBarItem("id_tab4","tab4","tabButton: More"); 
window.plugins.nativeControls.showTabBarItems("id_tab1", "id_tab2", 
"id_tab3", "id_tab4"); 
window.plugins.nativeControls.showTabBar(); 
    }
	
	function displayMessage(theMessage) {
		document.getElementById('theMessage').innerHTML = theMessage;
	}

	var theData = new Lawnchair({adaptor:'dom'});

	function doLoad() {
		theData.get('login',
			function(theLogin){
				if (theLogin) {
					document.location = 'home.html';
				} else {
					displayMessage ("No Login found...")
				}
			});
	}

		function doSave() {
			// Retrieve the values from the form elements
			theEmail = document.getElementById('login_email').value;
			thePassword = document.getElementById('login_password').value;
			if (theEmail == "") {
				displayMessage('Please enter a username');
			} else if (thePassword == "") {
				displayMessage('Please enter a password');
			} else {	 		x$().xhr('http://tickets.cplummer.co.uk/development/verifyLogin.cfm?email='+theEmail+'&password='+thePassword, 	{ callback:
							function() { 
								if(this.responseText == "1 ") { // Verified!
									// Construct an object with the login info
									var theLogin = {key:'login', Username:theEmail, Password:thePassword};
									// Send them to the data store
									theData.save(theLogin);
									// Go to the main function page
									document.location = 'home.html';

								} else { // Failed!
									x$('#theMessage').inner(this.responseText);
								}; // callback function
							}
						}); 
					}
				}
				
		function doLogout() {
			theData.remove('login');
			document.location = '../index.html';
		}
	</script>
</head>
<body onLoad="onLoad();">

	<div data-role="page" data-theme="a" id="jqm-home">

		<div data-role="content"> 

			<form action="" method="post">
				<span id="theMessage">&nbsp;</span>
				<div data-role="fieldcontain"> 
		         	<label for="login_email">Email:</label> 
		         	<input type="email" name="login_email" id="login_email" value=""  /> 
				</div>
				<div data-role="fieldcontain"> 
		         	<label for="login_password">Password</label> 
		         	<input type="password" name="login_password" id="login_password" value="" /> 
				</div>
			
					<button type="button" data-theme="b" onclick="javascript:doSave();">Login</button>
					<button type="button" data-theme="a" onclick="javascript:doSave();">Register Account</button>
				</div>
			</form>
			
		</div>
	</div>
</body>